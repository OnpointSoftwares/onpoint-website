{% extends 'base.html' %}
{% load static %}

{% block title %}{{ title }} - OnPoint LMS{% endblock %}

{% block content %}
<div class="container py-4">
  <div class="row justify-content-center">
    <div class="col-lg-10 col-xl-9">
      <div class="card shadow-sm">
        <div class="card-body p-4">
          <h1 class="h4 mb-3">{{ title }}</h1>
          <p class="text-muted mb-4">Fill in the details below to publish your course. You can edit it later.</p>

          {% if messages %}
            {% for message in messages %}
              <div class="alert alert-{{ message.tags }}" role="alert">{{ message }}</div>
            {% endfor %}
          {% endif %}

          <form method="post" enctype="multipart/form-data" novalidate>
            {% csrf_token %}

            {% if form.non_field_errors %}
              <div class="alert alert-danger" role="alert">
                {% for error in form.non_field_errors %}
                  <div>{{ error }}</div>
                {% endfor %}
              </div>
            {% endif %}

            <div class="row g-3">
              <div class="col-md-8">
                <div class="mb-3">
                  <label class="form-label" for="id_title">Title</label>
                  {{ form.title }}
                  {% if form.title.errors %}
                    <div class="invalid-feedback d-block">{{ form.title.errors.0 }}</div>
                  {% endif %}
                </div>

                <div class="mb-3">
                  <label class="form-label" for="id_slug">Slug</label>
                  {{ form.slug }}
                  <div class="form-text">Unique URL identifier, e.g., python-for-beginners</div>
                  {% if form.slug.errors %}
                    <div class="invalid-feedback d-block">{{ form.slug.errors.0 }}</div>
                  {% endif %}
                </div>

                <div class="mb-3">
                  <label class="form-label" for="id_description">Description</label>
                  {{ form.description }}
                  {% if form.description.errors %}
                    <div class="invalid-feedback d-block">{{ form.description.errors.0 }}</div>
                  {% endif %}
                </div>

                <div class="mb-3">
                  <label class="form-label" for="id_curriculum">Curriculum</label>
                  {{ form.curriculum }}
                  <div class="form-text">Provide a structured outline of modules and lessons. You can use headings, lists, and links.</div>
                  {% if form.curriculum.errors %}
                    <div class="invalid-feedback d-block">{{ form.curriculum.errors.0 }}</div>
                  {% endif %}
                </div>
              </div>

              <div class="col-md-4">
                <div class="mb-3">
                  <label class="form-label" for="id_category">Category</label>
                  {{ form.category }}
                  {% if form.category.errors %}
                    <div class="invalid-feedback d-block">{{ form.category.errors.0 }}</div>
                  {% endif %}
                </div>

                <div class="mb-3">
                  <label class="form-label" for="id_image">Cover Image</label>
                  {{ form.image }}
                  {% if form.image.errors %}
                    <div class="invalid-feedback d-block">{{ form.image.errors.0 }}</div>
                  {% endif %}
                </div>

                <div class="mb-3 form-check form-switch">
                  {{ form.published }}
                  <label class="form-check-label ms-2" for="id_published">Published</label>
                </div>

                <div class="mb-3 form-check form-switch">
                  {{ form.is_paid }}
                  <label class="form-check-label ms-2" for="id_is_paid">Paid Course</label>
                </div>

                <div class="mb-3">
                  <label class="form-label" for="id_price">Price</label>
                  {{ form.price }}
                  {% if form.price.errors %}
                    <div class="invalid-feedback d-block">{{ form.price.errors.0 }}</div>
                  {% endif %}
                </div>

                <div class="mb-3">
                  <label class="form-label" for="id_difficulty">Difficulty</label>
                  {{ form.difficulty }}
                </div>
              </div>
            </div>

            <div class="d-flex justify-content-between align-items-center mt-4">
              <a href="{% url 'lms:instructor_dashboard' %}" class="btn btn-light">Cancel</a>
              <button type="submit" class="btn btn-primary">Save Course</button>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %}

{% block extra_scripts %}
  <script src="https://cdn.tiny.cloud/1/no-api-key/tinymce/6/tinymce.min.js" referrerpolicy="origin"></script>
  <script>
    document.addEventListener('DOMContentLoaded', function () {
      if (window.tinymce) {
        tinymce.init({
          selector: 'textarea.richtext',
          plugins: 'link lists image code table autoresize',
          toolbar: 'undo redo | styles | bold italic underline | alignleft aligncenter alignright | bullist numlist outdent indent | link image | code',
          menubar: false,
          skin: 'oxide-dark',
          content_css: 'dark',
          min_height: 300,
          convert_urls: false
        });
      }
    });
  </script>
{% endblock %}
