{% extends 'base.html' %}
{% load static %}

{% block title %}Coding Challenges - Practice Programming | OnPoint Software{% endblock %}

{% block meta %}
<meta name="description" content="Practice coding challenges with various difficulty levels. Improve your programming skills with our curated collection of problems.">
<meta name="keywords" content="coding challenges, programming practice, algorithms, data structures, coding interview">
<meta property="og:title" content="Coding Challenges - Practice Programming">
<meta property="og:description" content="Practice coding challenges with various difficulty levels. Improve your programming skills.">
<meta property="og:type" content="website">
<link rel="canonical" href="{{ request.build_absolute_uri }}">
{% endblock %}

{% block extra_head %}
<style>
  .challenge-card {
    transition: all 0.3s ease;
    border: 1px solid rgba(0,0,0,0.125);
  }
  .challenge-card:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    border-color: #0d6efd;
  }
  .difficulty-easy { border-left: 4px solid #198754; }
  .difficulty-medium { border-left: 4px solid #ffc107; }
  .difficulty-hard { border-left: 4px solid #dc3545; }
  .search-input:focus {
    box-shadow: 0 0 0 3px rgba(13, 110, 253, 0.25);
  }
  .filter-badge {
    animation: slideIn 0.3s ease;
  }
  @keyframes slideIn {
    from { opacity: 0; transform: translateX(-10px); }
    to { opacity: 1; transform: translateX(0); }
  }
  .loading-skeleton {
    background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
    background-size: 200% 100%;
    animation: loading 1.5s infinite;
  }
  @keyframes loading {
    0% { background-position: 200% 0; }
    100% { background-position: -200% 0; }
  }
</style>
{% endblock %}
{% block content %}
<div class="container py-4">
  <div class="d-flex flex-wrap align-items-center justify-content-between mb-3">
    <div class="mb-3 mb-md-0">
      <h1 class="h3 mb-1">Coding Challenges</h1>
      <div class="text-muted small">Practice problems with difficulty levels and tags. Filter to find the right challenge.</div>
    </div>
    <div class="d-flex align-items-center gap-2">
      <a href="{% url 'coding_challenges:leaderboard' %}" class="btn btn-outline-primary"><i class="bi bi-trophy me-1"></i> Leaderboard</a>
      {% if request.user.is_authenticated %}
        <a href="{% url 'coding_challenges:profile' %}" class="btn btn-primary"><i class="bi bi-person-circle me-1"></i> My Profile</a>
      {% else %}
        <a href="{% url 'login' %}" class="btn btn-primary">Sign In</a>
      {% endif %}
      {% if request.user.is_staff or perms.coding_challenges.add_challenge %}
        <a href="{% url 'coding_challenges:challenge_create' %}" class="btn btn-success">
          <i class="bi bi-plus-lg me-1"></i> Add Challenge
        </a>
      {% endif %}
    </div>
  </div>

  <div class="card border-0 shadow-sm mb-3">
    <div class="card-body">
      <form method="get" class="row g-2 align-items-end">
        <div class="col-12 col-md-4">
          <label for="search-input" class="form-label small text-muted">Search Challenges</label>
          <div class="input-group">
            <span class="input-group-text bg-light" aria-hidden="true"><i class="bi bi-search"></i></span>
            <input type="text" id="search-input" name="q" value="{{ search|default:'' }}" 
                   class="form-control search-input" 
                   placeholder="Search by title, description, or tags..." 
                   aria-label="Search challenges" 
                   autocomplete="off" 
                   data-debounce="300">
            {% if search %}
              <button type="button" class="btn btn-outline-secondary" onclick="document.getElementById('search-input').value=''; this.form.submit();" aria-label="Clear search">
                <i class="bi bi-x-lg"></i>
              </button>
            {% endif %}
          </div>
        </div>
        <div class="col-6 col-md-3">
          <label class="form-label small text-muted">Difficulty</label>
          <select name="difficulty" class="form-select">
            <option value="">All difficulties</option>
            <option value="easy" {% if difficulty == 'easy' %}selected{% endif %}>Easy</option>
            <option value="medium" {% if difficulty == 'medium' %}selected{% endif %}>Medium</option>
            <option value="hard" {% if difficulty == 'hard' %}selected{% endif %}>Hard</option>
          </select>
        </div>
        <div class="col-6 col-md-3">
          <label class="form-label small text-muted">Tag</label>
          <select name="tag" class="form-select">
            <option value="">All tags</option>
            {% for t in tags %}
              <option value="{{ t.slug }}" {% if tag_slug == t.slug %}selected{% endif %}>{{ t.name }} ({{ t.count }})</option>
            {% endfor %}
          </select>
        </div>
        <div class="col-12 col-md-2 d-flex gap-2">
          <button class="btn btn-secondary w-100" type="submit"><i class="bi bi-funnel me-1"></i> Filter</button>
          <a href="{% url 'coding_challenges:dashboard' %}" class="btn btn-outline-secondary w-100"><i class="bi bi-arrow-counterclockwise me-1"></i> Reset</a>
        </div>
      </form>
      <div class="d-flex flex-wrap align-items-center justify-content-between mt-3">
        <div class="text-muted small">
          Showing {{ challenges|length }} result{% if challenges|length != 1 %}s{% endif %}
        </div>
        <div class="d-flex flex-wrap gap-2">
          {% if search %}<span class="badge bg-light text-dark border"><i class="bi bi-search me-1"></i>{{ search }}</span>{% endif %}
          {% if difficulty %}
            <span class="badge bg-{% if difficulty == 'easy' %}success{% elif difficulty == 'medium' %}warning text-dark{% else %}danger{% endif %}">{{ difficulty|title }}</span>
          {% endif %}
          {% if tag_slug %}
            <span class="badge bg-info text-dark"><i class="bi bi-tag me-1"></i>{{ tag_slug }}</span>
          {% endif %}
          {% if request.user.is_staff or perms.coding_challenges.add_challenge %}
            <a href="{% url 'coding_challenges:dashboard' %}" class="btn btn-sm btn-outline-secondary"><i class="bi bi-gear me-1"></i> Manage</a>
          {% endif %}
        </div>
      </div>
    </div>
  </div>

  <div class="row g-3" id="challenges-grid">
    {% for c in challenges %}
      <div class="col-12 col-sm-6 col-lg-4">
        <article class="card h-100 shadow-sm challenge-card difficulty-{{ c.difficulty }}" role="article">
          <div class="card-body d-flex flex-column">
            <div class="d-flex justify-content-between align-items-center mb-3">
              <span class="badge bg-{% if c.difficulty == 'easy' %}success{% elif c.difficulty == 'medium' %}warning text-dark{% else %}danger{% endif %}" 
                    aria-label="Difficulty: {{ c.get_difficulty_display }}">{{ c.get_difficulty_display }}</span>
              {% if c.id in solved_ids %}
                <span class="badge bg-success" aria-label="Challenge completed">
                  <i class="bi bi-check2-circle me-1" aria-hidden="true"></i>Solved
                </span>
              {% endif %}
            </div>
            <h3 class="card-title h5 mb-2">
              <a href="{% url 'coding_challenges:challenge_detail' c.slug %}" 
                 class="text-decoration-none stretched-link" 
                 aria-describedby="challenge-{{ c.id }}-desc">{{ c.title }}</a>
            </h3>
            <p class="card-text text-muted small flex-grow-1" id="challenge-{{ c.id }}-desc">
              {{ c.problem_statement|striptags|truncatewords:20 }}
            </p>
            <div class="mt-auto">
              <div class="d-flex flex-wrap align-items-center justify-content-between gap-2 mb-2">
                <div class="small text-muted d-flex align-items-center gap-2">
                  <span title="Time limit"><i class="bi bi-clock me-1" aria-hidden="true"></i>{{ c.time_limit_ms }}ms</span>
                  <span title="Memory limit"><i class="bi bi-hdd me-1" aria-hidden="true"></i>{{ c.memory_limit_kb|floatformat:0 }}KB</span>
                </div>
                <div class="small text-muted">
                  {% if c.tags.all %}
                    {% for tag in c.tags.all|slice:":2" %}
                      <span class="badge bg-light text-dark border me-1">#{{ tag.name }}</span>
                    {% endfor %}
                    {% if c.tags.all|length > 2 %}
                      <span class="text-muted">+{{ c.tags.all|length|add:"-2" }}</span>
                    {% endif %}
                  {% endif %}
                </div>
              </div>
            </div>
          </div>
        </article>
      </div>
    {% empty %}
      <div class="col-12">
        <div class="alert alert-info d-flex flex-wrap align-items-center justify-content-between">
          <div>No challenges found. Try adjusting filters.</div>
          {% if request.user.is_staff or perms.coding_challenges.add_challenge %}
            <a href="{% url 'coding_challenges:challenge_create' %}" class="btn btn-sm btn-success mt-2 mt-md-0">
              <i class="bi bi-plus-lg me-1"></i> Add Your First Challenge
            </a>
          {% endif %}
        </div>
      </div>
    {% endfor %}
  </div>
  <div class="mt-3">
    {% if challenges.has_other_pages %}
      <nav aria-label="Challenges pagination" class="d-flex justify-content-center">
        <ul class="pagination mb-0">
          {% if challenges.has_previous %}
            <li class="page-item"><a class="page-link" href="?page={{ challenges.previous_page_number }}&q={{ search }}&difficulty={{ difficulty }}&tag={{ tag_slug }}">Previous</a></li>
          {% endif %}
          <li class="page-item disabled"><span class="page-link">Page {{ challenges.number }} of {{ challenges.paginator.num_pages }}</span></li>
          {% if challenges.has_next %}
            <li class="page-item"><a class="page-link" href="?page={{ challenges.next_page_number }}&q={{ search }}&difficulty={{ difficulty }}&tag={{ tag_slug }}">Next</a></li>
          {% endif %}
        </ul>
      </nav>
    {% endif %}
  </div>
</div>
{% endblock %}
